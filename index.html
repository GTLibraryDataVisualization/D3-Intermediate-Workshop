<!DOCTYPE html>
<html>
<head>
	<title>Georgia Tech 2016 Crime Map</title>
	<!-- import D3 and Leaflet -->
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link rel="stylesheet" type="text/css" href="stylesheet.css" />
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"> </script>
</head>

<body>
	<div id="container">
	 <div id="header">
	 </div>
	 <div id="content_area">
		<div id="left_col"></div>
		<div id="right_col">
		 <div id="mapid"></div>
	 	</div>
	 </div>
		<div id="footer"></div>
	</div>
</body>

	<script type="text/javascript">
		//set coordinates to GT's student center
		var atl = new L.LatLng(33.77487566, -84.39795059);
		//create map object with GT's student center at the center of map
		var mymap = L.map('mapid').setView(atl, 16);
		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
				maxZoom: 18,
				minZoom: 15,
				id: 'mapbox.light',
				accessToken: 'pk.eyJ1IjoiamFnb2R3aW4iLCJhIjoiY2lnOGQxaDhiMDZzMXZkbHYzZmN4ZzdsYiJ9.Uwh_L37P-qUoeC-MBSDteA'
		}).addTo(mymap);

		//svg layer on top of the map object to write data points
		var svgLayer = L.svg();
		svgLayer.addTo(mymap)

		var svg = d3.select("#mapid").select("svg");
		var listview = d3.select("#left_col").append("ul");

		var g = svg.select("g");
		g.attr("class", "leaflet-zoom-hide");

		//load in the data from crime_log.csv
		d3.csv('/crime_log.csv', function(error, nodes) {
			if(error)
					console.log(error)

			listview.selectAll("li")
				.data(nodes).enter()
				.append("li")
				.html(function(d) {
					// console.log(d);
					// return JSON.stringify(d);
					var OCANumber = d["OCANumber"];
					var IncidentFromDate = d["IncidentFromDate"];
					var IncidentFromTime = d["IncidentFromTime"];
					var IncidentToDate = d["IncidentToDate"];
					var IncidentToTime = d["IncidentToTime"];
					var OffenseCode = d["OffenseCode"];
					var Offense_Description = d["Offense Description"];
					var CaseStatus = d["CaseStatus"];
					var CaseDisposition = d["CaseDisposition"];
					var LocationCode = d["LocationCode"];
					var PatrolZone = d["PatrolZone"];
					var LocationLandmark = d["LocationLandmark"];
					var LocationStreetNumber = d["LocationStreetNumber"];
					var LocationDirectional = d["LocationDirectional"];
					var LocationStreet = d["LocationStreet"];
					var LocationLatitude = d["LocationLatitude"];
					var LocationLongitude = d["LocationLongitude"];
					return "OCANumber: " + OCANumber + "<br />" +
									"IncidentFromTime: " + IncidentFromTime + "<br />" +
									"IncidentToDate: " + IncidentToDate + "<br />" +
									"IncidentToTime: " + IncidentToTime + "<br />" +
									"OffenseCode: " + OffenseCode + "<br />" +
									"Offense Description: " + Offense_Description + "<br />" +
									"CaseStatus: " + CaseStatus + "<br />" +
									"CaseDisposition: " + CaseDisposition + "<br />" +
									"LocationCode: " + LocationCode + "<br />" +
									"PatrolZone: " + PatrolZone + "<br />" +
									"LocationLandmark: " + LocationLandmark + "<br />" +
									"LocationStreetNumber: " + LocationStreetNumber + "<br />" +
									"LocationDirectional: " + LocationDirectional + "<br />" +
									"LocationStreet: " + LocationStreet + "<br />" +
									"LocationLatitude: " + LocationLatitude + "<br />" +
									"LocationLongitude: " + LocationLongitude;
				})
				.on("click", function(d) {
					// console.log(d3.select(this).select("li"));
					// d3.select(this).select(this).style("fill", "red");
				})
				.style("fill", "red");
			//creating the circle dots from the data in crime_log.csv
			g.selectAll('circle')
					.data(nodes)
					.enter().append('circle')
							.style("opacity", 0.3)
							.style("fill", 'red')
							.attr('r', 6)

			//setting the location of the circle dots from the data in crime_log.csv
			nodes.forEach(function(d){
					d.LatLng = [+d.LocationLatitude, +d.LocationLongitude];
			})

			mymap.on('zoomend', updateNodes);

			updateNodes();
		})

		function updateNodes(){
		    g.selectAll('circle')
		        .attr('cx', function(d){return mymap.latLngToLayerPoint(d.LatLng).x})
		        .attr('cy', function(d){return mymap.latLngToLayerPoint(d.LatLng).y})
		}

	</script>

</html>
